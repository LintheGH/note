---
title: 使用 ts-loader 的自定义转换器自动实现多语言功能
date: 2022/02/10 18:10:17
categories: 
- Code
- JavaScript
tags: 
- framework
---

在现有项目已经接近完成的情况下，突然需要给项目添加多语言支持，多方搜索，比较广泛的处理方案不外乎两种，一种是从零开始的项目，同步搭建多语言环境（如i8next），然后在编写代码过程中同步处理语言；第二种是通过构建工具，提取中文做成一个中英文对应的key、value值的对象，然后对源码中的字符串进行替换，取处理出来的键值对象。

第一种处理方案是比较彻底的和安全的，但是花费的工作量也很大，需要一一添加多语言内容，无技术含量且重复；第二种相对来说是比较省力的解决方法，但是确定是失去了多语言工具的灵活性，在扩展相应工具比如浏览器语言检测时并没有那么方便快捷；所以综合考虑下来，决定采取两种方法结合的方式，通过配置语言环境的同时使用构建工具自动处理字符串文本，这样即减少了工作量，也有多语言工具的灵活性、扩展性。

<!--more-->
### 调研
- `babel-loader`

  可以使用 `babel/parser`来对源文件进行提取处理字符串，但是由于项目中使用了 `typescript`， 存在在一些语法 `babel/parser` 无法编译的情况，同时如果需要在源文件中插入语句，需要兼容现有项目中的习惯（如封装习惯），故放弃

- `ts-loader`

  `ts-loader`是十分合适的处理工具，

- `TS customer transformer` 自定义转换器

  `typescript`通过内部的转换器将 ts 文件转换为 js 文件，从 2.3 版本开始，TS 将这个转换器开放出来，共开发者自定义编写转换器，从而实现如删除注释、改变变量、插入语句等的功能。

- TS 转换过程

  ![TS 转换过程](https://github.com/LintheGH/images/blob/master/note/ts%20transformer.png)

  从 ts 的编译过程可以看到，在 before 阶段，可以注入我们的代码，同时不用担心各种语法问题

### 编写
- `i18next`

    多语言环境采用 `i18next` ，根据官网配置即可

    - 这里采用了 `react-i18next` 和 ``